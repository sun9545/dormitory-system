# 📖 智能宿舍查寝管理系统 - 用户使用手册

欢迎使用智能宿舍查寝管理系统！本手册将帮助您快速上手系统的各项功能。

---

## 👥 用户角色

系统支持三种用户角色：

- **👨‍💼 管理员** - 拥有所有权限，管理整个系统
- **👨‍🏫 辅导员** - 管理自己负责的学生
- **👨‍🎓 学生** - 查看自己的签到记录和请假申请

---

## 🔐 登录系统

### 管理员/辅导员登录

1. 浏览器访问系统地址：`http://your-domain.com`
2. 输入用户名和密码
3. 点击"登录"按钮

**首次登录**：
- 默认管理员账号：`admin` / `admin123`
- ⚠️ 首次登录后请立即修改密码

### 学生申请请假

学生通过专用申请页面：`http://your-domain.com/apply_leave.php`

---

## 📋 主要功能

### 1. 控制面板（首页）

登录后进入控制面板，可以看到：

#### 今日统计概况
- 📊 学生总数
- ✅ 在寝人数
- ❌ 未签到人数
- 📝 请假人数

#### 各楼栋统计
- 点击楼栋可展开查看各楼层详细数据
- 点击红色的"未签到"数字可跳转查看详细名单
- 右上角可以按辅导员筛选

#### 快速操作
- 查看统计
- 请假管理
- 学生管理
- 上传请假名单
- **批量签到** - 手动为学生批量签到

---

### 2. 学生管理

#### 2.1 查看学生列表

**路径**：导航菜单 → 学生管理

**功能**：
- 查看所有学生信息
- 按楼栋、区域、班级、辅导员筛选
- 搜索学生（学号或姓名）
- 查看学生详细信息

#### 2.2 添加学生

1. 点击"添加学生"按钮
2. 填写学生信息：
   - 学号（必填）
   - 姓名（必填）
   - 性别
   - 班级
   - 宿舍信息（楼栋、区域、楼层、宿舍号、床号）
   - 辅导员信息
3. 点击"保存"

#### 2.3 批量导入学生

1. 点击"批量导入"按钮
2. 下载模板文件（Excel 或 CSV）
3. 按照模板格式填写学生信息
4. 上传文件
5. 系统会显示预览，确认无误后点击"确认导入"

**模板格式**：
```
学号,姓名,性别,班级,楼栋,区域,楼层,宿舍号,床号,辅导员,辅导员电话
2024001,张三,男,计算机1班,10,A,3,301,1,李老师,13800138000
```

#### 2.4 编辑和删除

- 点击学生姓名可查看详细信息
- 点击"编辑"可修改学生信息
- 点击"删除"可删除学生（⚠️ 谨慎操作）

---

### 3. 查寝签到

#### 3.1 查看签到记录

**路径**：导航菜单 → 查寝统计

**功能**：
- 按日期查看签到情况
- 按状态筛选（在寝/离寝/请假/未签到）
- 按楼栋、楼层筛选
- 导出签到数据

#### 3.2 手动签到

有两种方式：

**方式一：首页批量签到**
1. 首页点击"批量签到"按钮
2. 输入学号（支持多个，用逗号或换行分隔）
3. 点击"查询学生信息"
4. 确认学生信息无误后，点击"确认签到"

**方式二：ESP32 指纹识别**
- 学生在 ESP32 设备上按指纹
- 系统自动识别并记录签到

#### 3.3 签到状态说明

- **在寝** ✅ - 学生已签到
- **离寝** ❌ - 学生未签到
- **请假** 📝 - 学生请假，已批准
- **未签到** ⏸️ - 尚未签到（默认状态）

---

### 4. 请假管理

#### 4.1 学生申请请假

**学生操作流程**：

1. 访问请假申请页面：`http://your-domain.com/apply_leave.php`
2. 输入身份信息：
   - 学号
   - 姓名
   - 验证码
3. 选择请假日期（可选择多个不连续日期）
4. 填写请假原因
5. 点击"提交申请"
6. 等待辅导员审批

**注意事项**：
- 每小时最多提交 5 次申请（防刷机制）
- 可以查看自己的申请记录
- 待审批的申请可以撤销

#### 4.2 辅导员审批请假

**路径**：导航菜单 → 请假审批

**审批流程**：

1. 查看待审批列表
   - 🟡 待审批
   - 🟢 已批准
   - 🔴 已拒绝
   
2. 点击"审批"按钮
3. 选择：
   - **批准** - 自动生成请假记录，学生当天显示"请假"状态
   - **拒绝** - 填写拒绝原因，学生可重新申请
   
4. 填写审批备注（可选）

**权限说明**：
- 辅导员只能看到自己负责学生的申请
- 管理员可以看到所有学生的申请

#### 4.3 请假管理（管理员）

**路径**：导航菜单 → 请假管理

**功能**：

1. **手动添加请假**
   - 输入学号
   - 选择请假日期
   - 点击"添加请假"

2. **批量上传请假名单**
   - 下载 CSV 模板
   - 填写学号和请假日期
   - 上传文件

**模板格式**：
```csv
学号,请假日期
2024001,2024-11-05
2024002,2024-11-05
```

3. **取消请假**
   - 找到对应的请假记录
   - 点击"取消请假"
   - 学生状态恢复为取消前状态

4. **导出请假数据**
   - 选择日期
   - 点击"下载请假数据"

---

### 5. 指纹管理

#### 5.1 查看指纹映射

**路径**：导航菜单 → 指纹管理

显示学生指纹与设备的映射关系。

#### 5.2 添加指纹映射

**前置条件**：
- 学生已在 ESP32 设备上录入指纹
- 知道指纹在设备中的 ID（0-999）

**操作步骤**：
1. 点击"添加指纹映射"
2. 填写信息：
   - 学号
   - 设备 ID（如：FP001-10-1）
   - 指纹 ID（设备中的编号）
   - 手指编号（可选）
3. 点击"保存"

#### 5.3 批量导入指纹映射

1. 点击"批量导入"
2. 下载模板
3. 填写映射关系
4. 上传文件

**模板格式**：
```csv
学号,设备ID,指纹ID,手指编号
2024001,FP001-10-1,0,1
2024002,FP001-10-1,1,2
```

---

### 6. 设备管理

#### 6.1 查看设备列表

**路径**：导航菜单 → 设备管理

**显示信息**：
- 设备 ID
- 设备名称
- 楼栋位置
- 在线状态（🟢 在线 / 🔴 离线）
- 已录入指纹数
- 最后在线时间

#### 6.2 添加设备

1. 点击"添加设备"
2. 填写信息：
   - 设备 ID（如：FP001-10-1）
   - 设备名称
   - 楼栋号
   - 设备序号
   - 位置描述
3. 点击"保存"

#### 6.3 查看设备日志

**路径**：导航菜单 → 设备日志

**功能**：
- 查看设备运行日志
- 按日志级别筛选（DEBUG/INFO/WARN/ERROR）
- 按设备筛选
- 按时间范围筛选
- 用于排查设备故障

---

### 7. 数据统计

#### 7.1 查寝统计

**路径**：导航菜单 → 查寝统计

**功能**：
- 按日期查看统计
- 按楼栋、区域、楼层筛选
- 按状态筛选
- 查看详细名单
- 导出统计数据

#### 7.2 请假统计

在请假管理页面可以：
- 查看当天请假人数
- 查看历史请假记录
- 按日期筛选
- 导出请假数据

---

### 8. 系统设置

#### 8.1 修改密码

**路径**：右上角头像 → 修改密码

1. 输入当前密码
2. 输入新密码（至少 8 位，包含字母和数字）
3. 确认新密码
4. 点击"保存"

#### 8.2 个人信息

**路径**：右上角头像 → 个人信息

可以修改：
- 姓名
- 手机号
- 邮箱

#### 8.3 用户管理（仅管理员）

**路径**：导航菜单 → 用户管理

**功能**：
- 添加/编辑/删除用户
- 设置用户角色（管理员/辅导员）
- 重置用户密码
- 查看登录日志

---

## 💡 使用技巧

### 1. 快速签到

在首页使用"批量签到"功能，可以快速为多名学生签到，支持：
- 从 Excel 复制学号列粘贴
- 逗号、空格、换行分隔
- 最多一次 100 人

### 2. 辅导员筛选

在首页右上角可以按辅导员筛选，方便辅导员只查看自己负责的学生。

### 3. 导出数据

大部分列表页面都支持导出功能，点击"导出"按钮即可下载 CSV 文件。

### 4. 数据备份

**管理员定期备份**：
- 路径：导航菜单 → 系统维护 → 数据库备份
- 或使用定时任务自动备份

---

## ❓ 常见问题

### Q1: 学生忘记签到怎么办？

**答**：管理员或辅导员可以在首页使用"批量签到"功能手动为学生补签。

### Q2: 学生请假申请如何撤销？

**答**：学生在申请页面点击"查看我的申请记录"，找到待审批的申请，点击"撤销"。

### Q3: ESP32 设备离线怎么办？

**答**：
1. 检查设备电源和网络连接
2. 在设备管理页面查看最后在线时间
3. 查看设备日志排查问题
4. 检查 WiFi 配置和服务器地址

### Q4: 如何批量删除学生？

**答**：目前不支持批量删除，需要逐个删除。建议先导出数据备份再删除。

### Q5: 导入学生时出现错误？

**答**：
1. 检查文件格式是否正确（Excel 或 CSV）
2. 确认表头与模板一致
3. 检查必填字段是否完整
4. 学号不能重复
5. 查看错误提示，修正后重新导入

### Q6: 如何查看某个学生的历史签到记录？

**答**：
1. 进入"查寝统计"页面
2. 在搜索框输入学号或姓名
3. 选择日期范围
4. 点击"查询"

---

## 🔔 重要提醒

1. ⚠️ **首次登录后请立即修改默认密码**
2. ⚠️ **定期备份数据库，避免数据丢失**
3. ⚠️ **请假审批操作不可撤销，请谨慎操作**
4. ⚠️ **删除学生会同时删除其签到记录，请谨慎操作**
5. ⚠️ **ESP32 设备的 API Token 必须与服务器一致**

---

## 📞 技术支持

如有问题或建议，请联系：

- 作者：T-SUN
- GitHub：https://github.com/sun9545/dormitory-system

---

## 📝 更新记录

- **2024-11** - v1.2 版本，完善请假系统
- **2024-10** - v1.1 版本，增加指纹识别
- **2024-09** - v1.0 版本，系统上线

---

<p align="center">
  感谢使用智能宿舍查寝管理系统！
  <br>
  Made by T-SUN
</p>

